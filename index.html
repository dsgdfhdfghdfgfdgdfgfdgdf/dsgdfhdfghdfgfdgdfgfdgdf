from flask import Flask, send_from_directory
import webview
import threading
import webbrowser
import os
import sys
import time

app = Flask(__name__)
PORT = 5000
server_url = f"http://127.0.0.1:{PORT}/"

@app.route('/')
def index():
    return send_from_directory('.', 'claude_chat.html')

def start_server():
    app.run(host='127.0.0.1', port=PORT, threaded=True)

def open_browser():
    webbrowser.open(server_url)
    print(f"Claude Chat открыт в браузере по адресу: {server_url}")

def open_webview():
    webview.create_window("Claude Chat", server_url)
    webview.start()

def show_menu():
    print("\n" + "="*50)
    print("Claude Chat - выберите режим работы:")
    print("="*50)
    print("1. Открыть в WebView (отдельное окно приложения)")
    print("2. Открыть в браузере")
    print("="*50)
    
    while True:
        choice = input("Введите номер варианта (1-2): ")
        if choice == "1":
            return "webview"
        elif choice == "2":
            return "browser"
        else:
            print("Неверный выбор. Пожалуйста, введите 1 или 2.")

if __name__ == '__main__':
    # Запускаем Flask в отдельном потоке
    server_thread = threading.Thread(target=start_server)
    server_thread.daemon = True
    server_thread.start()
    
    # Даем серверу время на запуск
    time.sleep(1)
    
    # Показываем меню выбора
    choice = show_menu()
    
    # Открываем в выбранном режиме
    if choice == "webview":
        open_webview()
    else:
        open_browser()
        
        # Держим программу запущенной
        print("\nСервер запущен. Нажмите Ctrl+C для завершения...")
        try:
            # Бесконечный цикл, чтобы приложение не завершалось
            while True:
                time.sleep(1)
        except KeyboardInterrupt:
            print("\nПрограмма завершена.")
